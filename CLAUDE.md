# Universal File Converter

## Project Structure
- `backend/` — Python FastAPI API (venv at `backend/venv/`)
- `frontend/` — React + Vite + Tailwind CSS
- `nginx/` — Reverse proxy config
- `scripts/` — Cron jobs (S3 cleanup)
- `docs/plans/` — Design doc and implementation plan

## Commands
- Backend tests: `cd backend && source venv/bin/activate && python -m pytest -v`
- Frontend build: `cd frontend && npm run build`
- Backend dev server: `cd backend && source venv/bin/activate && uvicorn app.main:app --reload`
- Frontend dev server: `cd frontend && npm run dev`

## Architecture
- API routes: `backend/app/routes/` (upload, convert, download)
- Services: `backend/app/services/` (validator, s3, image_converter, document_converter)
- S3 singleton: import `s3_service` from `app.services.s3`, don't create new instances
- Rate limiter: import `limiter` from `app.limiter` (separate module to avoid circular imports)
- CORS: configured via `CORS_ORIGINS` env var, never use `"*"`

## Testing
- S3 tests use `moto` mock (`@mock_aws` + `s3_client` fixture in `conftest.py`)
- Route tests mock `s3_service` via `@patch("app.routes.<module>.s3_service")`
- Binary test fixtures in `backend/test_fixtures/` (generated by `tests/generate_fixtures.py`)
- LibreOffice tests use `@pytest.mark.skipif(shutil.which("libreoffice") is None)`

## Security Patterns
- Always sanitize filenames with `os.path.basename()` before S3 keys
- Validate job_id as UUID format before S3 operations
- Store validated MIME type in S3 object metadata, don't re-detect
- Cap file reads: `await file.read(MAX_SIZE + 1)`, reject if oversized

## Not Implemented (V2)
- PDF → DOCX conversion (pdf2docx removed from requirements)
- OCR (Tesseract)
- Batch conversion
- Watermarks
- Resize UI (backend supports it, frontend doesn't expose it)
